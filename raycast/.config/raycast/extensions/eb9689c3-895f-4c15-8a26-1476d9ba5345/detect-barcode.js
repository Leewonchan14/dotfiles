"use strict";var m=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var F=(e,t)=>{for(var i in t)m(e,i,{get:t[i],enumerable:!0})},R=(e,t,i,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of P(t))!C.call(e,o)&&o!==i&&m(e,o,{get:()=>t[o],enumerable:!(c=z(t,o))||c.enumerable});return e};var k=e=>R(m({},"__esModule",{value:!0}),e);var U={};F(U,{default:()=>T});module.exports=k(U);var r=require("@raycast/api");var w=require("@raycast/api"),y=require("path"),h=require("fs/promises"),S=require("child_process");async function B(e,...t){if(process.platform==="win32")return Promise.reject(new Error("Swift functions are not supported on Windows"));let i=(0,y.join)(w.environment.assetsPath,"compiled_raycast_swift/swift");return await(0,h.chmod)(i,"755"),new Promise((c,o)=>{let f=[e];for(let n of t)try{f.push(JSON.stringify(n,(a,s)=>s===void 0?null:s))}catch(a){o(new u("Failed to serialize input to JSON: "+a.message));return}let d=(0,S.spawn)(i,f),l=[],g=[];d.stdout?.on("data",n=>{l.push(n.toString())}),d.stderr?.on("data",n=>{g.push(n.toString())}),d.on("exit",n=>{if(n===0)try{let a=l.join("").trim();a.length!=0?c(JSON.parse(a)):c(null)}catch(a){let s=new u("Failed to deserialize result from JSON: "+a.message);s.stdout=l.join("").trim(),s.stderr=g.join("").trim(),o(s)}else{let a=new u(g.join("").trim()||l.join("").trim()||"Could not get any data");a.stdout=l.join("").trim(),a.stderr=g.join("").trim(),o(a)}}),d.on("error",n=>{o(n)})})}async function L(e){return await B("detectBarcode",e)}var u=class extends Error{constructor(t){super(t),this.name="SwiftError"}};var p=require("@raycast/api");var v=()=>(0,p.getPreferenceValues)();var x=async()=>{let e=v();try{return await L(e.keepImage)}catch(t){throw console.error(t),new Error("Failed to detect barcode")}};async function T(){await(0,r.closeMainWindow)();try{let e=await x();if(!e||e==="No barcodes or QR codes detected")return await(0,r.showToast)({style:r.Toast.Style.Failure,title:"No barcodes or QR codes detected"});await r.Clipboard.copy(e),await(0,r.showToast)({style:r.Toast.Style.Success,title:"Copied barcode/QR code to clipboard"})}catch(e){console.error(e),await(0,r.showToast)({style:r.Toast.Style.Failure,title:"Failed detecting barcode/QR code"})}}
